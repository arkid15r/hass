- sensor:
    - name: Outdoor Temperature
      unique_id: outdoor_temperature
      unit_of_measurement: °F
      state: >
        {{ expand('group.weather_services') |
            map(attribute='attributes.temperature') |
            reject('eq', undefined) |
            map('float') |
            list |
            average |
            round
        }}

    - name: Temperature Forecast
      unique_id: temperature_forecast
      unit_of_measurement: °F
      state: >
        {{ expand('group.weather_services') |
            map(attribute='attributes.forecast') |
            reject('eq', undefined) |
            map(attribute='0.temperature') |
            map('float') |
            list |
            average |
            round
        }}

    - name: Outdoor Humidity
      unique_id: outdoor_humidity
      unit_of_measurement: '%'
      state: >
        {{ expand('group.weather_services') |
            map(attribute='attributes.humidity') |
            reject('eq', undefined) |
            map('float') |
            list |
            average |
            round
        }}

    - name: Temperature Low Forecast
      unique_id: temperature_low_forecast
      unit_of_measurement: °F
      state: >
        {{ expand('group.weather_services') |
            map(attribute='attributes.forecast') |
            reject('eq', undefined) |
            map(attribute='0.templow') |
            map('float') |
            list |
            average |
            round
        }}

    - name: Weather Forecast Summary
      unique_id: weather_forecast_summary
      state: >
        {% if states('sensor.temperature_low_forecast') | int < 40 or
            states('sensor.wind_speed_forecast') | int > 15
        %}
          extremely concerning
        {% elif states('sensor.temperature_low_forecast') | int < 50 or
            states('sensor.wind_speed_forecast') | int > 10
        %}
          very concerning
        {% elif states('sensor.temperature_low_forecast') | int < 60 or
            states('sensor.wind_speed_forecast') | int > 5
        %}
          a bit concerning
        {% else %}
          fine
        {% endif %}

    - name: Weather State
      unique_id: weather_state
      state: >
        {% set weather = states(states('input_text.weather_service')) | lower %}
        {% if weather == 'partlycloudy' %}
          partly cloudy
        {% else %}
          {{ weather }}
        {% endif %}

    - name: Wind Speed
      unique_id: wind_speed
      unit_of_measurement: mph
      state: >
        {{ expand('group.weather_services') |
            map(attribute='attributes.wind_speed') |
            reject('eq', undefined) |
            map('float') |
            list |
            average |
            round
        }}

    - name: Wind Speed Forecast
      unique_id: wind_speed_forecast
      unit_of_measurement: mph
      state: >
        {{ expand('group.weather_services') |
            map(attribute='attributes.forecast') |
            reject('eq', undefined) |
            map(attribute='0.wind_speed') |
            map('float') |
            list |
            average |
            round
        }}
