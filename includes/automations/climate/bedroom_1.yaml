- id: bedroom_1_humidifier
  alias: Bedroom 1 Humidifier
  trigger:
    - platform: numeric_state
      entity_id: sensor.bedroom_1_humidity
      above: input_number.bedroom_1_humidity_high
    - platform: numeric_state
      entity_id: sensor.bedroom_1_humidity
      below: input_number.bedroom_1_humidity_low
    - platform: state
      entity_id: sensor.bedroom_1_humidity
      to: 'unavailable'
      for:
        minutes: 5
    - platform: time_pattern
      minutes: /5
  condition:
    - condition: state
      entity_id: binary_sensor.bedroom_1_window
      state: 'off'
  action:
    - choose:
        - conditions:
            - condition: numeric_state
              entity_id: sensor.bedroom_1_humidity
              above: input_number.bedroom_1_humidity_high
          sequence:
            - service: scene.turn_on
              target:
                entity_id: scene.bedroom_1_humidifier_off
        - conditions:
            - condition: numeric_state
              entity_id: sensor.bedroom_1_humidity
              below: input_number.bedroom_1_humidity_low
            - condition: time
              after: input_datetime.night_lights_time_on
              before: input_datetime.morning_lights_time_off
          sequence:
            - service: scene.turn_on
              target:
                entity_id: scene.bedroom_1_humidifier_on
        - conditions:
            - condition: state
              entity_id: sensor.bedroom_1_humidity
              state: 'unavailable'
          sequence:
            - service: scene.turn_on
              target:
                entity_id: scene.bedroom_1_humidifier_off

- id: bedroom_1_humidifier_on_window_state
  alias: 'Bedroom 1 Humidifier On Window State'
  trigger:
    - platform: state
      entity_id: binary_sensor.bedroom_1_window
      for:
        seconds: 10
  action:
    - choose:
        - conditions:
            - condition: state
              entity_id: binary_sensor.bedroom_1_window
              state: 'off'
            - condition: time
              after: input_datetime.night_lights_time_on
              before: input_datetime.morning_lights_time_off
          sequence:
            - service: scene.turn_on
              target:
                entity_id: scene.bedroom_1_humidifier_on
        - conditions:
            - condition: state
              entity_id: binary_sensor.bedroom_1_window
              state: 'on'
          sequence:
            - service: scene.turn_on
              target:
                entity_id: scene.bedroom_1_humidifier_off
