- id: office_1_fan
  alias: Office 1 Fan
  trigger:
    - platform: state
      entity_id: binary_sensor.office_1_motion
    - platform: state
      entity_id: binary_sensor.office_1_motion_15m
  action:
    - choose:
        - conditions:
            - condition: numeric_state
              entity_id: sensor.office_1_temperature
              below: sensor.office_1_desired_temperature
          sequence:
            - service: scene.turn_on
              target:
                entity_id: scene.office_1_fan_off
        - conditions:
            - condition: state
              entity_id: binary_sensor.office_1_motion_15m
              state: 'off'
          sequence:
            - service: scene.turn_on
              target:
                entity_id: scene.office_1_fan_off

        - conditions:
            - condition: numeric_state
              entity_id: sensor.office_1_temperature
              above: sensor.office_1_desired_temperature
            - condition: numeric_state
              entity_id: sensor.outdoor_temperature
              above: sensor.office_1_temperature
            - condition: state
              entity_id: binary_sensor.office_1_motion_15m
              state: 'on'
            - condition: state
              entity_id: binary_sensor.quite_time
              state: 'off'
          sequence:
            - service: scene.turn_on
              target:
                entity_id: scene.office_1_fan_on

- id: office_1_heating_mat
  alias: Office 1 Heating Mat
  trigger:
    - platform: state
      entity_id: binary_sensor.office_1_motion
    - platform: state
      entity_id: binary_sensor.office_1_motion_15m
  condition:
    - condition: state
      entity_id: binary_sensor.quite_time
      state: 'off'
  action:
    - choose:
        - conditions:
            - condition: state
              entity_id: binary_sensor.office_1_motion_15m
              state: 'on'
          sequence:
            - service: scene.turn_on
              target:
                entity_id: scene.office_1_heating_mat_on
        - conditions:
            - condition: state
              entity_id: binary_sensor.office_1_motion_15m
              state: 'off'
          sequence:
            - service: scene.turn_on
              target:
                entity_id: scene.office_1_heating_mat_off

- id: office_1_humidifier
  alias: Office 1 Humidifier
  trigger:
    - platform: numeric_state
      entity_id: sensor.office_1_humidity
      above: input_number.office_1_humidity_high
    - platform: numeric_state
      entity_id: sensor.office_1_humidity
      below: input_number.office_1_humidity_low
    - platform: state
      entity_id: sensor.office_1_humidity
      to: 'unavailable'
      for:
        minutes: 5
    - platform: time_pattern
      minutes: /5
  condition:
    - condition: state
      entity_id: binary_sensor.office_1_window
      state: 'off'
  action:
    - choose:
        - conditions:
            - condition: numeric_state
              entity_id: sensor.office_1_humidity
              above: input_number.office_1_humidity_high
          sequence:
            - service: scene.turn_on
              target:
                entity_id: scene.office_1_humidifier_off
        - conditions:
            - condition: numeric_state
              entity_id: sensor.office_1_humidity
              below: input_number.office_1_humidity_low
            - condition: time
              after: input_datetime.post_quite_time_range_3
              before: input_datetime.pre_quite_time_range_3
          sequence:
            - service: scene.turn_on
              target:
                entity_id: scene.office_1_humidifier_on
        - conditions:
            - condition: state
              entity_id: sensor.office_1_humidity
              state: 'unavailable'
          sequence:
            - service: scene.turn_on
              target:
                entity_id: scene.office_1_humidifier_off

- id: office_1_humidifier_on_windows_state
  alias: Office 1 Humidifier On Windows State
  trigger:
    - platform: state
      entity_id: binary_sensor.office_1_window
  action:
    - choose:
        - conditions:
            - condition: state
              entity_id: binary_sensor.office_1_window
              state: 'on'
          sequence:
            - service: scene.turn_on
              target:
                entity_id: scene.office_1_humidifier_off
        - conditions:
            - condition: state
              entity_id: binary_sensor.office_1_window
              state: 'off'
            - condition: time
              after: input_datetime.post_quite_time_range_3
              before: input_datetime.pre_quite_time_range_3
          sequence:
            - service: scene.turn_on
              target:
                entity_id: scene.office_1_humidifier_on

- id: turn_off_idle_office_1_fan
  alias: '[Turn Off Idle Office 1 Fan]'
  use_blueprint:
    path: target_turn_off.yaml
    input:
      check_frequency_minutes: /5
      scene: scene.office_1_fan_off
      target: switch.office_1_fan
      target_active_time_seconds: 900
      watcher: binary_sensor.office_1_motion
      watcher_inactive_time_seconds: 300

- id: turn_off_idle_office_1_heating_mat
  alias: '[Turn Off Idle Office 1 Heating Mat]'
  use_blueprint:
    path: target_turn_off.yaml
    input:
      check_frequency_minutes: /5
      scene: scene.office_1_heating_mat_off
      target: switch.office_1_heating_mat
      target_active_time_seconds: 900
      watcher: binary_sensor.office_1_motion
      watcher_inactive_time_seconds: 300
