- id: tts_garden_extra_watering_reminder
  alias: 'TTS: Garden Extra Watering Reminder'
  trigger:
    - platform: time
      at:
        - '09:50:00'
        - '13:50:00'
        - '17:50:00'
  condition:
    - condition: state
      entity_id: binary_sensor.garden_season
      state: 'on'
  action:
    - choose:
        - conditions:
            - condition: numeric_state
              entity_id: sensor.outdoor_temperature
              above: input_number.weather_extreme_temperature
          sequence:
            - event: tts
              event_data:
                areas_on:
                  - great_room
                text: <audio src="soundbank://soundlibrary/alarms/beeps_and_bloops/tone_05"/>Just FYI, the outdoor temperature is extremely high. I strongly recommend an additional watering of your garden. Thank you!
        - conditions:
            - condition: numeric_state
              entity_id: sensor.outdoor_temperature
              above: input_number.weather_high_temperature
          sequence:
            - event: tts
              event_data:
                areas_on:
                  - great_room
                text: <audio src="soundbank://soundlibrary/alarms/beeps_and_bloops/tone_05"/>Just FYI, the outdoor temperature is quite high. I recommend an additional watering of your garden. Thank you!
      default:
        - event: tts
          event_data:
            areas_on:
              - great_room
            text: <audio src="soundbank://soundlibrary/alarms/beeps_and_bloops/tone_05"/>Just FYI, the garden watering is starting in 10 minutes. Please make sure that all irrigation valves are in expected states. Thank you!

- id: tts_porch_cooling_station_reminder
  alias: 'TTS: Porch Cooling Station Reminder'
  trigger:
    - platform: time
      at: '10:50:00'
  condition:
    - condition: numeric_state
      entity_id: sensor.temperature_forecast
      above: input_number.weather_extreme_temperature
    - condition: state
      entity_id: binary_sensor.pickup_day
      state: 'on'
  action:
    - event: tts
      event_data:
        duration: 15
        text: <audio src="soundbank://soundlibrary/alarms/beeps_and_bloops/tone_05"/>Just FYI, the forecasted temperature is extremely high. A porch cooling station would be very appreciated by postal workers. Thank you!

- id: tts_start_airing_reminder
  alias: 'TTS: Start Airing Reminder'
  trigger:
    - platform: state
      entity_id: binary_sensor.thermal_perimeter
      from: ['off', 'on']
      to: ['off', 'on']
    - platform: time_pattern
      minutes: /10
  condition:
    - condition: state
      entity_id: sensor.air_quality
      state: ['good', 'moderate']
    - condition: or
      conditions:
        - condition: time
          after: '08:00:00'
          before: '11:00:00'
        - condition: time
          after: '18:00:00'
          before: '21:00:00'
    - condition: or
      conditions:
        - condition: state
          entity_id: binary_sensor.airing_floor_1
          state: 'off'
        - condition: state
          entity_id: binary_sensor.airing_floor_2
          state: 'off'
    - condition: numeric_state
      entity_id: sensor.indoor_temperature
      above: 75
    - condition: numeric_state
      entity_id: sensor.outdoor_temperature
      above: 75
    - condition: state
      entity_id: binary_sensor.hvac_is_cooling
      state: 'off'
    - condition: state
      entity_id: binary_sensor.indoor_temperature_3_degree_higher
      state: 'on'
  action:
    - event: tts
      event_data:
        duration: 10
        text: <audio src='soundbank://soundlibrary/alarms/beeps_and_bloops/tone_05'/>Just FYI, the temperature outside is lower at the moment. I suggest opening windows and doors right now.

- id: tts_state_air_quality_changed
  alias: 'TTS State: Air Quality Changed'
  trigger:
    - platform: state
      entity_id: sensor.air_quality
      to: ['moderate', 'unhealthy']
  condition:
    - condition: state
      entity_id: binary_sensor.quite_time
      state: 'off'
    - condition: state
      entity_id: input_boolean.mode_nap
      state: 'off'
    - condition: state
      entity_id: input_boolean.play_tts_messages
      state: 'on'
    - condition: template
      value_template: >
        {{ trigger.from_state.state != 'unavailable' }}
    - condition: template
      value_template: >
        {{ trigger.to_state.state != 'unavailable' }}
  action:
    - event: tts
      event_data:
        text: <audio src="soundbank://soundlibrary/alarms/beeps_and_bloops/tone_05"/>The air quality changed to {{ states('sensor.air_quality') }}. Sincerely yours, <phoneme alphabet="ipa" ph="ɹus'lanə 'pɪ:sə:nka">Ruslana Pysanka</phoneme>.

- id: tts_state_weather_changed
  alias: 'TTS State: Weather Changed'
  trigger:
    - platform: state
      entity_id: sensor.weather_state
      from: &weather_states
        - exceptional
        - hail
        - lightning
        - lightning-rainy
        - pouring
        - rainy
        - snowy
        - snowy-rainy
        - windy
    - platform: state
      entity_id: sensor.weather_state
      to: *weather_states
  condition:
    - condition: state
      entity_id: binary_sensor.quite_time
      state: 'off'
    - condition: state
      entity_id: input_boolean.mode_nap
      state: 'off'
    - condition: state
      entity_id: input_boolean.play_tts_messages
      state: 'on'
    - condition: template
      value_template: >
        {{ trigger.from_state.state != 'unavailable' }}
    - condition: template
      value_template: >
        {{ trigger.to_state.state != 'unavailable' }}
  action:
    - event: tts
      event_data:
        text: <audio src="soundbank://soundlibrary/alarms/beeps_and_bloops/tone_05"/>The weather changed to {{ states('sensor.weather_state') }}. The temperature is {{ states('sensor.outdoor_temperature') }} degrees with relative humidity around {{ states('sensor.outdoor_humidity') }} percents. The wind speed is {{ states('sensor.wind_speed') }} miles per hour. Sincerely yours, <phoneme alphabet="ipa" ph="ɹus'lanə 'pɪ:sə:nka">Ruslana Pysanka</phoneme>.

- id: tts_stop_airing_reminder
  alias: 'TTS: Stop Airing Reminder'
  trigger:
    - platform: time_pattern
      minutes: /10
  condition:
    - condition: numeric_state
      entity_id: sensor.indoor_temperature
      above: 82
    - condition: numeric_state
      entity_id: sensor.outdoor_temperature
      above: 82
    - condition: state
      entity_id: binary_sensor.thermal_perimeter
      state: 'on'
      for: 00:15:00
    - condition: time
      after: '08:00:00'
      before: '18:00:00'
  action:
    - choose:
        - conditions:
            - condition: state
              entity_id: binary_sensor.indoor_temperature_higher
              state: 'off'
          sequence:
            - event: tts
              event_data:
                duration: 15
                text: <audio src='soundbank://soundlibrary/alarms/beeps_and_bloops/tone_05'/>Just FYI, the temperature outside seems to be higher than inside. I suggest closing   {{ state_attr('sensor.thermal_perimeter_breached', 'entities_summary') }} right now.
        - conditions:
            - condition: state
              entity_id: binary_sensor.indoor_temperature_3_degree_higher
              state: 'off'
          sequence:
            - event: tts
              event_data:
                duration: 15
                text: <audio src='soundbank://soundlibrary/alarms/beeps_and_bloops/tone_05'/>Just FYI, the temperature outside is going to be higher soon. I suggest closing       {{ state_attr('sensor.thermal_perimeter_breached', 'entities_summary') }} right now.

- id: tts_weather_forecast
  alias: 'TTS: Weather Forecast'
  trigger:
    - platform: time
      at: '19:00:00'
  condition:
    - condition: state
      entity_id: input_boolean.play_tts_messages
      state: 'on'
  action:
    - choose:
        - conditions:
            - condition: state
              entity_id: binary_sensor.garden_season
              state: 'off'
          sequence:
            - event: tts
              event_data:
                duration: 15
                text: <audio src="soundbank://soundlibrary/alarms/beeps_and_bloops/tone_05"/>Here is the weather forecast for tomorrow. The lowest forecasted temperature is around {{ states('sensor.temperature_low_forecast') }} degrees. The highest forecasted wind speed is {{ states('sensor.wind_speed_forecast') }} miles per hour. Sincerely yours, <phoneme alphabet='ipa' ph="ɹus'lanə 'pɪ:sə:nka">Ruslana Pysanka</phoneme>.
        - conditions:
            - condition: not
              conditions:
                - condition: state
                  entity_id: sensor.weather_forecast_summary
                  state: fine
          sequence:
            - event: tts
              event_data:
                duration: 15
                text: <audio src="soundbank://soundlibrary/alarms/beeps_and_bloops/tone_05"/>Hey gardeners, the weather forecast looks {{ states('sensor.weather_forecast_summary') }}. The lowest forecasted temperature is around {{ states('sensor.temperature_low_forecast') }} degrees. The highest forecasted wind speed is {{ states('sensor.wind_speed_forecast') }} miles per hour. Sincerely yours, <phoneme alphabet='ipa' ph="ɹus'lanə 'pɪ:sə:nka">Ruslana Pysanka</phoneme>.
